<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Horizon Enterprises</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        flex: 1;
      }

      header {
        background: linear-gradient(135deg, #2c3e50, #3498db);
        color: white;
        padding: 1rem 0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo i {
        font-size: 2.5rem;
      }

      .logo h1 {
        font-size: 1.8rem;
        font-weight: 600;
      }

      .nav-buttons {
        display: flex;
        gap: 15px;
      }

      .btn {
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        font-size: 0.9rem;
      }

      .btn-primary {
        background-color: #2ecc71;
        color: white;
      }

      .btn-primary:hover {
        background-color: #27ae60;
      }

      .login-container {
        max-width: 400px;
        margin: 100px auto;
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .login-title {
        text-align: center;
        margin-bottom: 1.5rem;
        color: #2c3e50;
        font-size: 1.8rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2c3e50;
      }

      .form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
        transition: border 0.3s ease;
      }

      .form-control:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      .submit-btn {
        width: 100%;
        padding: 12px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .submit-btn:hover {
        background-color: #2980b9;
      }

      .message {
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 1rem;
        text-align: center;
        display: none;
      }

      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .admin-dashboard {
        display: none;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .dashboard-title {
        color: #2c3e50;
        font-size: 2rem;
      }

      .logout-btn {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
      }

      .stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 15px;
      }

      .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 200px;
        text-align: center;
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 0.5rem;
      }

      .stat-label {
        color: #7f8c8d;
        font-weight: 600;
      }

      .inquiries-section {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .section-title {
        margin-bottom: 1rem;
        color: #2c3e50;
        font-size: 1.5rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #3498db;
        color: white;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      .status-pending {
        color: #e67e22;
        font-weight: 600;
      }

      .status-completed {
        color: #2ecc71;
        font-weight: 600;
      }

      .action-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 0.8rem;
        margin-right: 5px;
      }

      .mark-complete {
        background-color: #2ecc71;
        color: white;
      }

      .delete-btn {
        background-color: #e74c3c;
        color: white;
      }

      footer {
        text-align: center;
        padding: 2rem 0;
        margin-top: auto;
        color: #7f8c8d;
        border-top: 1px solid #ecf0f1;
      }

      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 15px;
        }

        .stats {
          flex-direction: column;
        }

        th,
        td {
          padding: 8px 10px;
          font-size: 0.9rem;
        }

        table {
          display: block;
          overflow-x: auto;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <img
              src="/images/horizonlogo.jpg"
              alt="horizon-logo"
              style="width: 160px; height: 100px; mix-blend-mode: multiply"
            />
            <h1>Horizon Enterprises - Admin Panel</h1>
          </div>
          <!-- <div class="nav-buttons">
                    <a href="form.html" class="btn btn-primary">Back to Form</a>
                </div> -->
        </div>
      </div>
    </header>

    <div class="container">
      <!-- Login Form -->
      <div class="login-container" id="loginForm">
        <h3 class="login-title">Admin Login</h3>
        <div id="loginMessage" class="message"></div>

        <div class="form-group">
          <label for="username">Username</label>
          <input
            type="text"
            id="username"
            class="form-control"
            placeholder="Enter username"
          />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            class="form-control"
            placeholder="Enter password"
          />
        </div>

        <button class="submit-btn" id="loginBtn">Login</button>
      </div>

      <!-- Admin Dashboard -->
      <div class="admin-dashboard" id="adminDashboard">
        <div class="dashboard-header">
          <h2 class="dashboard-title">Admin Dashboard</h2>
          
          <button
            class="btn btn-primary"
            id="exportBtn"
            style="margin-bottom: 15px"
          >
            <i class="fa-solid fa-file-excel"></i> Export to Excel
          </button>
          <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalInquiries">0</div>
            <div class="stat-label">Total Inquiries</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="todayInquiries">0</div>
            <div class="stat-label">Today's Inquiries</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="pendingInquiries">0</div>
            <div class="stat-label">Pending Responses</div>
          </div>
        </div>

        <div class="inquiries-section">
          <h3 class="section-title">Customer Inquiries</h3>
          <table id="inquiriesTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Email</th>
                <th>Mobile</th>
                <th>Organization</th>
                <th>Query</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="inquiriesTableBody">
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <p>&copy; 2023 Horizon Enterprises. All rights reserved.</p>
        <p>Premium Stationery Manufacturers Since 1987</p>
      </div>
    </footer>

    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBXx6OJhdD4CUw0izhJQQ3v6A_IhN15xDA",
        authDomain: "horizon-ee3be.firebaseapp.com",
        projectId: "horizon-ee3be",
        storageBucket: "horizon-ee3be.firebasestorage.app",
        messagingSenderId: "741004395317",
        appId: "1:741004395317:web:78c3eb9b0770bf273a827c",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // DOM elements
      const loginForm = document.getElementById("loginForm");
      const adminDashboard = document.getElementById("adminDashboard");
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const loginMessageDiv = document.getElementById("loginMessage");
      const inquiriesTableBody = document.getElementById("inquiriesTableBody");
      const totalInquiries = document.getElementById("totalInquiries");
      const todayInquiries = document.getElementById("todayInquiries");
      const pendingInquiries = document.getElementById("pendingInquiries");

      // Check if user is already logged in
      if (localStorage.getItem("adminLoggedIn") === "true") {
        loginForm.style.display = "none";
        adminDashboard.style.display = "block";
        loadInquiries();
      }

      // Login functionality
      loginBtn.addEventListener("click", () => {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (username === "horizonent" && password === "enthorizon123") {
          // Successful login
          localStorage.setItem("adminLoggedIn", "true");
          loginForm.style.display = "none";
          adminDashboard.style.display = "block";
          loadInquiries();
        } else {
          showMessage(loginMessageDiv, "Invalid username or password", "error");
        }
      });

      // Logout functionality
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("adminLoggedIn");
        adminDashboard.style.display = "none";
        loginForm.style.display = "block";
        // Clear the form fields on logout
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
      });

      // Show message function
      function showMessage(element, message, type) {
        element.textContent = message;
        element.className = `message ${type}`;
        element.style.display = "block";

        setTimeout(() => {
          element.style.display = "none";
        }, 5000);
      }

      // Mark inquiry as completed
      async function markAsCompleted(inquiryId) {
        try {
          await db.collection("inquiries").doc(inquiryId).update({
            status: "Completed",
          });
          loadInquiries(); // Reload the data
        } catch (error) {
          console.error("Error updating inquiry: ", error);
        }
      }

      // Delete inquiry
      async function deleteInquiry(inquiryId) {
        if (confirm("Are you sure you want to delete this inquiry?")) {
          try {
            await db.collection("inquiries").doc(inquiryId).delete();
            loadInquiries(); // Reload the data
          } catch (error) {
            console.error("Error deleting inquiry: ", error);
          }
        }
      }

      // Load inquiries for admin panel
      async function loadInquiries() {
        try {
          const snapshot = await db
            .collection("inquiries")
            .orderBy("timestamp", "desc")
            .get();
          const inquiries = [];
          let todayCount = 0;
          let pendingCount = 0;
          const today = new Date().toDateString();

          inquiriesTableBody.innerHTML = "";

          snapshot.forEach((doc) => {
            const data = doc.data();
            const inquiry = {
              id: doc.id,
              ...data,
              date: data.timestamp
                ? data.timestamp.toDate().toLocaleDateString()
                : "N/A",
            };

            inquiries.push(inquiry);

            // Count today's inquiries
            if (
              data.timestamp &&
              data.timestamp.toDate().toDateString() === today
            ) {
              todayCount++;
            }

            // Count pending inquiries
            if (data.status === "Pending") {
              pendingCount++;
            }

            // Add to table
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${inquiry.date}</td>
                        <td>${inquiry.name}</td>
                        <td>${inquiry.email}</td>
                        <td>${inquiry.mobile}</td>
                        <td>${inquiry.organization || "N/A"}</td>
                        <td>${inquiry.query}</td>
                        <td class="status-${inquiry.status.toLowerCase()}">${
              inquiry.status
            }</td>
                        <td>
                            ${
                              inquiry.status === "Pending"
                                ? `<button class="action-btn mark-complete" onclick="markAsCompleted('${inquiry.id}')">Mark Complete</button>`
                                : ""
                            }
                            <button class="action-btn delete-btn" onclick="deleteInquiry('${
                              inquiry.id
                            }')">Delete</button>
                        </td>
                    `;
            inquiriesTableBody.appendChild(row);
          });

          // Update stats
          totalInquiries.textContent = inquiries.length;
          todayInquiries.textContent = todayCount;
          pendingInquiries.textContent = pendingCount;
        } catch (error) {
          console.error("Error loading inquiries: ", error);
        }
      }

      // Make functions globally available for onclick events
      window.markAsCompleted = markAsCompleted;
      window.deleteInquiry = deleteInquiry;
    </script>
    <script>
        // Export inquiries table to Excel
document.getElementById('exportBtn').addEventListener('click', () => {
    // Convert table to worksheet
    const table = document.getElementById('inquiriesTable');
    const workbook = XLSX.utils.table_to_book(table, { sheet: "Inquiries" });

    // Export to Excel file
    XLSX.writeFile(workbook, `Horizon_Inquiries_${new Date().toISOString().slice(0,10)}.xlsx`);
});

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  </body>
</html>
